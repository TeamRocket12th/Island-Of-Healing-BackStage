import{d as x,c as w,b as t,F as v,e as k,j as _,o as d,t as l,n as A,k as $,v as S,l as P,r as f,m as b,p as C}from"./index-ed710b8a.js";const I={key:0,class:"flex flex-col"},M={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},j={class:"py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"},B={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"},z={class:"min-w-full divide-y divide-gray-200"},E=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," ID "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 標題 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 創建日期 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 作者 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 目前進度 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 變更進度 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"})])],-1),N={class:"bg-white divide-y divide-gray-200"},T={class:"px-6 py-4 whitespace-nowrap text-gray-500"},V={class:"px-6 py-4 whitespace-nowrap text-gray-500"},D={class:"px-6 py-4 whitespace-nowrap text-gray-500"},O={class:"px-6 py-4 whitespace-nowrap text-gray-500"},F={class:"px-6 py-4 whitespace-nowrap text-gray-500"},L={class:"py-1 flex gap-4"},U=["onUpdate:modelValue"],q=P('<option disabled selected>審核進度</option><option value="1">待審核</option><option value="2">審核中</option><option value="3">審核失敗</option><option value="4">審核成功</option>',5),R=[q],J={class:"px-6 py-4 whitespace-nowrap text-gray-500"},W=["onClick"],G=x({__name:"ReviewArticles",props:{reviewArticles:{type:Array,required:!0},getAllArticles:{type:Function,required:!0}},setup(p){const g=p,a="https://islandofhealing.rocket-coding.com/api",y=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/followedwriternewarticlenotification/create?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log(o.Message),await h(s);else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},h=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/pusher/followedwriternewarticle?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log("pushed fllower"),g.getAllArticles();else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},u=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/writernewarticlenotification/create?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log(o.Message),await n(s);else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},n=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/pusher/newarticleapproved?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log("pushed progress");else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},i=async(s,r)=>{const e=localStorage.getItem("token"),o=localStorage.getItem("adminId");if(!(!e&&!o)){console.log(s);try{const c=await(await fetch(`${a}/article/updateprogress/${r}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${e}`},method:"PUT",body:JSON.stringify({Progress:s.newProgress})})).json();if(console.log(c),c.StatusCode===200&&s.newProgress!=="4")alert(c.Message),g.getAllArticles();else if(c.StatusCode===200&&s.newProgress==="4")alert(c.Message),await u(r),await y(r);else throw new Error(`發生錯誤 ${c.Message}`)}catch(m){console.log(m)}}};return(s,r)=>p.reviewArticles?(d(),w("div",I,[t("div",M,[t("div",j,[t("div",B,[t("table",z,[E,t("tbody",N,[(d(!0),w(v,null,k(p.reviewArticles,e=>(d(),w("tr",{key:e.Id},[t("td",T,l(e.Id),1),t("td",V,l(e.Title),1),t("td",D,l(new Date(e.Initdate).toLocaleString()),1),t("td",O,l(e.WriterNickName),1),t("td",{class:A(["px-6 py-4 whitespace-nowrap text-gray-500",{"text-green-600":e.Progress==="審核成功","text-red-600":e.Progress==="待審核"}])},l(e.Progress),3),t("td",F,[t("div",L,[$(t("select",{"onUpdate:modelValue":o=>e.newProgress=o,class:"w-30 select select-sm select-bordered"},R,8,U),[[S,e.newProgress]])])]),t("td",J,[t("button",{type:"button",class:"btn-sm bg-slate-300 font-normal btn self-end",onClick:o=>i(e,e.Id)}," 確認 ",8,W)])]))),128))])])])])])])):_("",!0)}}),K=x({__name:"ArticleList",setup(p){const g="https://islandofhealing.rocket-coding.com/api",a=f(!0),y=n=>{switch(n){case"待審核":return"1";case"審核中":return"2";case"審核失敗":return"3";case"審核成功":return"4";default:return"1"}},h=f([]),u=async()=>{const n=localStorage.getItem("token");if(n)try{const s=await(await fetch(`${g}/administratorarticles/get`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}})).json();if(s.StatusCode===200)h.value=s.ArticlesData.map(r=>({...r,newProgress:y(r.Progress)})).reverse();else throw new Error(`發生錯誤 ${s.Message}`)}catch(i){console.log(i)}};return b(u),(n,i)=>(d(),w("div",null,[a.value?(d(),C(G,{key:0,reviewArticles:h.value,getAllArticles:u},null,8,["reviewArticles"])):_("",!0)]))}});export{K as default};
