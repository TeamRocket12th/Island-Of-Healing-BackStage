import{e as f,c as u,a as t,F as _,h as x,i as v,o as a,t as g,n as k,j as A,v as S,k as $,u as b,f as y,l as P,m}from"./index-f3e9be40.js";import{_ as C}from"./_plugin-vue_export-helper-c27b6911.js";const I={key:0,class:"flex flex-col"},B={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},M={class:"py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"},j={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"},N={class:"min-w-full divide-y divide-gray-200"},V=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," ID "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 標題 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 創建日期 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 作者 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 目前進度 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 變更進度 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"})])],-1),z={class:"bg-white divide-y divide-gray-200"},D={class:"px-6 py-4 whitespace-nowrap text-gray-500"},E={class:"px-6 py-4 whitespace-nowrap text-gray-500"},R={class:"px-6 py-4 whitespace-nowrap text-gray-500"},T={class:"px-6 py-4 whitespace-nowrap text-gray-500"},F={class:"px-6 py-4 whitespace-nowrap text-gray-500"},L={class:"py-1 flex gap-4"},O=["onUpdate:modelValue"],U=$('<option disabled selected>審核進度</option><option value="1">待審核</option><option value="2">審核中</option><option value="3">審核失敗</option><option value="4">審核成功</option>',5),q=[U],J={class:"px-6 py-4 whitespace-nowrap text-gray-500"},W=["onClick"],G=f({__name:"ReviewArticles",props:{reviewArticles:{type:Array,required:!0},getAllArticles:{type:Function,required:!0}},setup(c){const i=c,l="https://islandofhealing.rocket-coding.com/api",h=async r=>{const o=localStorage.getItem("token");if(o)try{const s=await(await fetch(`${l}/followedwriternewarticlenotification/create?articleid=${r}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${o}`},method:"POST"})).json();if(console.log(s),s.StatusCode===200)console.log(s.Message),await w(r);else throw new Error(`發生錯誤 ${s.Message}`)}catch(e){console.log(e)}},w=async r=>{const o=localStorage.getItem("token");if(o)try{const s=await(await fetch(`${l}/pusher/followedwriternewarticle?articleid=${r}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${o}`},method:"POST"})).json();if(console.log(s),s.StatusCode===200)console.log("pushed"),i.getAllArticles();else throw new Error(`發生錯誤 ${s.Message}`)}catch(e){console.log(e)}},d=async(r,o)=>{const e=localStorage.getItem("token"),s=localStorage.getItem("adminId");if(!(!e&&!s)){console.log(r);try{const n=await(await fetch(`${l}/article/updateprogress/${o}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${e}`},method:"PUT",body:JSON.stringify({Progress:r.newProgress})})).json();if(console.log(n),n.StatusCode===200&&r.newProgress!=="4")alert(n.Message),i.getAllArticles();else if(n.StatusCode===200&&r.newProgress==="4")alert(n.Message),h(o);else throw new Error(`發生錯誤 ${n.Message}`)}catch(p){console.log(p)}}};return(r,o)=>c.reviewArticles?(a(),u("div",I,[t("div",B,[t("div",M,[t("div",j,[t("table",N,[V,t("tbody",z,[(a(!0),u(_,null,x(c.reviewArticles,e=>(a(),u("tr",{key:e.Id},[t("td",D,g(e.Id),1),t("td",E,g(e.Title),1),t("td",R,g(new Date(e.Initdate).toLocaleString()),1),t("td",T,g(e.WriterNickName),1),t("td",{class:k(["px-6 py-4 whitespace-nowrap text-gray-500",{"text-green-600":e.Progress==="審核成功","text-red-600":e.Progress==="待審核"}])},g(e.Progress),3),t("td",F,[t("div",L,[A(t("select",{"onUpdate:modelValue":s=>e.newProgress=s,class:"w-30 select select-sm select-bordered"},q,8,O),[[S,e.newProgress]])])]),t("td",J,[t("button",{type:"button",class:"btn-sm bg-slate-300 font-normal btn self-end",onClick:s=>d(e,e.Id)}," 確認 ",8,W)])]))),128))])])])])])])):v("",!0)}}),H={};function K(c,i){return a(),u("div",null,"hi")}const Q=C(H,[["render",K]]),Z=f({__name:"ArticleList",setup(c){const i=b();console.log(i.currentRoute.value);const l="https://islandofhealing.rocket-coding.com/api",h=y(!0),w=o=>{switch(o){case"待審核":return"1";case"審核中":return"2";case"審核失敗":return"3";case"審核成功":return"4";default:return"1"}},d=y([]),r=async()=>{const o=localStorage.getItem("token");if(o)try{const s=await(await fetch(`${l}/administratorarticles/get`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${o}`}})).json();if(console.log(s),s.StatusCode===200)d.value=s.ArticlesData.map(p=>({...p,newProgress:w(p.Progress)})).reverse(),console.log(d.value);else throw new Error(`發生錯誤 ${s.Message}`)}catch(e){console.log(e)}};return P(r),(o,e)=>(a(),u("div",null,[h.value?(a(),m(G,{key:0,reviewArticles:d.value,getAllArticles:r},null,8,["reviewArticles"])):(a(),m(Q,{key:1}))]))}});export{Z as default};
