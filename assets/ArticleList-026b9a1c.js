import{e as x,c as h,a as t,F as v,h as k,i as A,o as c,t as g,n as $,j as S,v as P,k as C,f as m,l as b,m as _}from"./index-88941983.js";import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";const M={key:0,class:"flex flex-col"},j={class:"-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8"},B={class:"py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"},z={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg"},E={class:"min-w-full divide-y divide-gray-200"},N=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," ID "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 標題 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 創建日期 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 作者 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 目前進度 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"}," 變更進度 "),t("th",{scope:"col",class:"px-6 py-3 text-left font-medium text-gray-500 uppercase tracking-wider"})])],-1),T={class:"bg-white divide-y divide-gray-200"},V={class:"px-6 py-4 whitespace-nowrap text-gray-500"},D={class:"px-6 py-4 whitespace-nowrap text-gray-500"},O={class:"px-6 py-4 whitespace-nowrap text-gray-500"},F={class:"px-6 py-4 whitespace-nowrap text-gray-500"},L={class:"px-6 py-4 whitespace-nowrap text-gray-500"},U={class:"py-1 flex gap-4"},q=["onUpdate:modelValue"],R=C('<option disabled selected>審核進度</option><option value="1">待審核</option><option value="2">審核中</option><option value="3">審核失敗</option><option value="4">審核成功</option>',5),J=[R],W={class:"px-6 py-4 whitespace-nowrap text-gray-500"},G=["onClick"],H=x({__name:"ReviewArticles",props:{reviewArticles:{type:Array,required:!0},getAllArticles:{type:Function,required:!0}},setup(l){const d=l,a="https://islandofhealing.rocket-coding.com/api",y=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/followedwriternewarticlenotification/create?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log(o.Message),await u(s);else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},u=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/pusher/followedwriternewarticle?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log("pushed fllower"),d.getAllArticles();else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},w=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/writernewarticlenotification/create?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log(o.Message),await n(s);else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},n=async s=>{const r=localStorage.getItem("token");if(r)try{const o=await(await fetch(`${a}/pusher/newarticleapproved?articleid=${s}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`},method:"POST"})).json();if(console.log(o),o.StatusCode===200)console.log("pushed progress");else throw new Error(`發生錯誤 ${o.Message}`)}catch(e){console.log(e)}},p=async(s,r)=>{const e=localStorage.getItem("token"),o=localStorage.getItem("adminId");if(!(!e&&!o)){console.log(s);try{const i=await(await fetch(`${a}/article/updateprogress/${r}`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${e}`},method:"PUT",body:JSON.stringify({Progress:s.newProgress})})).json();if(console.log(i),i.StatusCode===200&&s.newProgress!=="4")alert(i.Message),d.getAllArticles();else if(i.StatusCode===200&&s.newProgress==="4")alert(i.Message),await w(r),await y(r);else throw new Error(`發生錯誤 ${i.Message}`)}catch(f){console.log(f)}}};return(s,r)=>l.reviewArticles?(c(),h("div",M,[t("div",j,[t("div",B,[t("div",z,[t("table",E,[N,t("tbody",T,[(c(!0),h(v,null,k(l.reviewArticles,e=>(c(),h("tr",{key:e.Id},[t("td",V,g(e.Id),1),t("td",D,g(e.Title),1),t("td",O,g(new Date(e.Initdate).toLocaleString()),1),t("td",F,g(e.WriterNickName),1),t("td",{class:$(["px-6 py-4 whitespace-nowrap text-gray-500",{"text-green-600":e.Progress==="審核成功","text-red-600":e.Progress==="待審核"}])},g(e.Progress),3),t("td",L,[t("div",U,[S(t("select",{"onUpdate:modelValue":o=>e.newProgress=o,class:"w-30 select select-sm select-bordered"},J,8,q),[[P,e.newProgress]])])]),t("td",W,[t("button",{type:"button",class:"btn-sm bg-slate-300 font-normal btn self-end",onClick:o=>p(e,e.Id)}," 確認 ",8,G)])]))),128))])])])])])])):A("",!0)}}),K={};function Q(l,d){return c(),h("div",null,"hi")}const X=I(K,[["render",Q]]),ee=x({__name:"ArticleList",setup(l){const d="https://islandofhealing.rocket-coding.com/api",a=m(!0),y=n=>{switch(n){case"待審核":return"1";case"審核中":return"2";case"審核失敗":return"3";case"審核成功":return"4";default:return"1"}},u=m([]),w=async()=>{const n=localStorage.getItem("token");if(n)try{const s=await(await fetch(`${d}/administratorarticles/get`,{headers:{"Content-type":"application/json",Authorization:`Bearer ${n}`}})).json();if(console.log(s),s.StatusCode===200)u.value=s.ArticlesData.map(r=>({...r,newProgress:y(r.Progress)})).reverse();else throw new Error(`發生錯誤 ${s.Message}`)}catch(p){console.log(p)}};return b(w),(n,p)=>(c(),h("div",null,[a.value?(c(),_(H,{key:0,reviewArticles:u.value,getAllArticles:w},null,8,["reviewArticles"])):(c(),_(X,{key:1}))]))}});export{ee as default};
